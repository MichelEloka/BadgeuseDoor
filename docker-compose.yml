# docker-compose.yml (Compose V2 : le champ "version" est inutile, on l'omet)
services:
  iotBadgeDoorSimulateor:
    build: ./iotsimulator
    container_name: iotBadgeDoorSimulateor
    image: badgeusedoor/iotbadgedoorsimulator
    environment:
      MQTT_HOST: "host.docker.internal"
      MQTT_PORT: "1883"
      SIMULATOR_DATA_DIR: "/data"
    ports:
      - "9002:9002"
    networks: [iot]
    volumes:
      - ./iotsimulator/simulator_data:/data
    restart: unless-stopped
  bridge:
    build: ./bridge
    container_name: bridge
    environment:
      # Si ton broker est le conteneur mosquitto du compose :
      MQTT_HOST: "host.docker.internal"
      MQTT_PORT: "1883"
      # MQTT_USER: ""
      # MQTT_PASS: ""
      BADGE_EVENTS_TOPIC: "iot/badgeuse/+/events"
      DOOR_CMDS_FMT: "iot/porte/{door_id}/commands"
      OPEN_ACTION: "open"
      AUTO_CLOSE_SEC: "5"   # 0 pour d√©sactiver la fermeture auto
      DEBOUNCE_SEC: "2"
    networks: [iot]
    restart: unless-stopped
    ports:
      - "9010:9010"

  entrance-cockpit-front:
    build: ./EntranceCockpitFront
    container_name: entrance-cockpit-front
    ports:
      - "4201:80"
    networks: [iot]
    restart: unless-stopped
 
networks:
  iot: {}


